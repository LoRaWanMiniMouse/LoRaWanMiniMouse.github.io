<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MiniMouse Stack: C:/GITEXT/githubdoc/LoRaWanMiniMouse.github.io/MMstack/UserCode/main.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="lora.bmp"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MiniMouse Stack
   &#160;<span id="projectnumber">V1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_4479a50ac3338962579017839c6d11ac.html">GITEXT</a></li><li class="navelem"><a class="el" href="dir_313566ed96e2d68b7746be4483e9b217.html">githubdoc</a></li><li class="navelem"><a class="el" href="dir_a1fe12ccd40675146f9c8376113c041e.html">LoRaWanMiniMouse.github.io</a></li><li class="navelem"><a class="el" href="dir_502a2e6a450cda7c1e5931c413e42c70.html">MMstack</a></li><li class="navelem"><a class="el" href="dir_287984a24aa2b0df1572ba9f4b944a4c.html">UserCode</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">main.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="main_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;mbed.h&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_lora_mac_data_store_in_flash_8h.html">LoraMacDataStoreInFlash.h</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_lora_wan_process_8h.html">LoraWanProcess.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_define_8h.html">Define.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="utilities_8h.html">utilities.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_user_define_8h.html">UserDefine.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="appli_8h.html">appli.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_s_x126x_8h.html">SX126x.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_api_mcu_8h.html">ApiMcu.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="main_8cpp.html#af39987ed395cff959b6956b3452952be">   33</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structs_back_up_flash.html">sBackUpFlash</a> <a class="code" href="main_8cpp.html#af39987ed395cff959b6956b3452952be">BackUpFlash</a>;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<a class="code" href="class_mcu_x_x.html">McuXX&lt;McuSTM32L4&gt;</a> <a class="code" href="main_8cpp.html#a3e7125d0f4c5b5efc1236698c02752ef">mcu</a> ( <a class="code" href="_user_define_8h.html#a3f5699acd29748e068ddd6d6c28b8fab">LORA_SPI_MOSI</a>, <a class="code" href="_user_define_8h.html#af8db8e4d626d327ad8a7b2bf4455209c">LORA_SPI_MISO</a>, <a class="code" href="_user_define_8h.html#a7d5bea89ac1696411e1f40209e7ebaa7">LORA_SPI_SCLK</a> ) ;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="main_8cpp.html#a095120399a6edc8ae3886936fc33eb20">   46</a></span>&#160;uint8_t <a class="code" href="main_8cpp.html#a095120399a6edc8ae3886936fc33eb20">LoRaMacNwkSKeyInit</a>[] = { 0x22, 0x33, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11};</div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="main_8cpp.html#aa622c47d7e66633f4b919c1e7668f0f7">   47</a></span>&#160;uint8_t <a class="code" href="main_8cpp.html#aa622c47d7e66633f4b919c1e7668f0f7">LoRaMacAppSKeyInit</a>[] = { 0x11, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22};</div><div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="main_8cpp.html#aaec460fc9ebcf36ea2ecd5ad4826ec36">   48</a></span>&#160;uint8_t <a class="code" href="main_8cpp.html#aaec460fc9ebcf36ea2ecd5ad4826ec36">LoRaMacAppKeyInit</a>[]  = { 0xBB, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11};</div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="main_8cpp.html#a2ed723ad16bfc8c263d17e23dde91bed">   49</a></span>&#160;uint8_t <a class="code" href="main_8cpp.html#a2ed723ad16bfc8c263d17e23dde91bed">AppEuiInit</a>[]         = { 0x70, 0xb3, 0xd5, 0x7e, 0xf0, 0x00, 0x36, 0x12 };</div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="main_8cpp.html#a41858b10db6a7676108c1193fd9efaba">   50</a></span>&#160;uint8_t <a class="code" href="main_8cpp.html#a41858b10db6a7676108c1193fd9efaba">DevEuiInit</a>[]         = { 0x11, 0x22, 0x33, 0x44, 0x44, 0x33, 0x22, 0xbb };    </div><div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="main_8cpp.html#a6103d2355d60728852bb0828c4bad37e">   51</a></span>&#160;uint32_t <a class="code" href="main_8cpp.html#a6103d2355d60728852bb0828c4bad37e">LoRaDevAddrInit</a>     = 0x26011918;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">   53</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>( ) {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    uint8_t UserPayloadSize ;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    uint8_t UserPayload [14];</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    uint8_t UserRxPayloadSize;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    uint8_t UserRxPayload [25];</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    uint8_t UserFport ;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    uint8_t UserRxFport ;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    uint8_t MsgType ;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <a class="code" href="_define_8h.html#a1287040ce87452e6c780ec0917441aea">eDataRateStrategy</a> AppDataRate = <a class="code" href="_define_8h.html#a1287040ce87452e6c780ec0917441aeaa91850405983bdf8c8f74f6aada3dd398">STATIC_ADR_MODE</a>; <span class="comment">// adr mode manage by network</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    uint8_t AppTimeSleeping = 6 ;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <a class="code" href="main_8cpp.html#a3e7125d0f4c5b5efc1236698c02752ef">mcu</a>.InitMcu ( );</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="main_8cpp.html#a3e7125d0f4c5b5efc1236698c02752ef">mcu</a>.RtcInit ( );</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="main_8cpp.html#a3e7125d0f4c5b5efc1236698c02752ef">mcu</a>.WatchDogStart ( );</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="main_8cpp.html#a3e7125d0f4c5b5efc1236698c02752ef">mcu</a>.LowPowerTimerLoRaInit();</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#if DEBUG_TRACE == 1</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    pcf.baud( 115200 );</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#endif    </span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <a class="code" href="structs_lo_ra_wan_keys.html">sLoRaWanKeys</a>  LoraWanKeys ={<a class="code" href="main_8cpp.html#a095120399a6edc8ae3886936fc33eb20">LoRaMacNwkSKeyInit</a>, <a class="code" href="main_8cpp.html#aa622c47d7e66633f4b919c1e7668f0f7">LoRaMacAppSKeyInit</a>, <a class="code" href="main_8cpp.html#aaec460fc9ebcf36ea2ecd5ad4826ec36">LoRaMacAppKeyInit</a>, <a class="code" href="main_8cpp.html#a2ed723ad16bfc8c263d17e23dde91bed">AppEuiInit</a>, <a class="code" href="main_8cpp.html#a41858b10db6a7676108c1193fd9efaba">DevEuiInit</a>, <a class="code" href="main_8cpp.html#a6103d2355d60728852bb0828c4bad37e">LoRaDevAddrInit</a>,<a class="code" href="_define_8h.html#a1e0a07faefc3dd68bbdd06f7c856cc74ae38e7cd490c6c7efecee77617004e358">OTA_DEVICE</a>};</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <a class="code" href="class_s_x1276.html">SX1276</a>  RadioUser( <a class="code" href="_user_define_8h.html#a1cccfa48213935b19a2a848cc25cddf3">LORA_CS</a>, <a class="code" href="_user_define_8h.html#a34f60e4069b1e8a10b1e4e73a446f952">LORA_RESET</a>, <a class="code" href="_class_s_t_m32_l0_8h.html#aed07b4957134494f3545189abece0f04">TX_RX_IT</a>, <a class="code" href="_class_s_t_m32_l0_8h.html#a106bb2c77f5f8bbd6ec084f37e9c6506">RX_TIMEOUT_IT</a>);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="class_lora_wan_object.html">LoraWanObject&lt;LoraRegionsEU,SX1276&gt;</a> Lp( LoraWanKeys,&amp;RadioUser,<a class="code" href="_user_define_8h.html#ac4f86f88b3a4d50662612b4e40c63c83">USERFLASHADRESS</a>); </div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">//SX126x  RadioUser( LORA_BUSY, LORA_CS, LORA_RESET,TX_RX_IT );</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">//LoraWanObject&lt;LoraRegionsEU,SX126x&gt; Lp( LoraWanKeys,&amp;RadioUser,USERFLASHADRESS); </span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    uint8_t AvailableRxPacket = <a class="code" href="_define_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da97bb67b41ce2bd4f20bd3318c4c4739a">NO_LORA_RXPACKET_AVAILABLE</a> ;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="_define_8h.html#acabcd539e4bcc6575c90bd7d857b21f4">eLoraWan_Process_States</a> LpState = <a class="code" href="_define_8h.html#a9aa4864b327c9be843762dbedf6419e4a8bd48a2deed5279c6bf53c9448af5ef0">LWPSTATE_IDLE</a>;    </div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="main_8cpp.html#a3e7125d0f4c5b5efc1236698c02752ef">mcu</a>.wait(2);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    Lp.<a class="code" href="class_lora_wan_object.html#a29662757556ca754ab1b314efd350a6c">RestoreContext</a>  ( );</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">while</span>(1) {</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        </div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        UserFport       = 3;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        UserPayloadSize = 9;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        MsgType = <a class="code" href="_define_8h.html#a99fb83031ce9923c84392b4e92f956b5a6b0e555756b3d5210f52cc4f1c7b7f6a">UNCONF_DATA_UP</a>;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <a class="code" href="appli_8cpp.html#a717519fd04fb87ffa62bb98e5306b83b">PrepareFrame</a> ( UserPayload );</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        UserPayload[8]  = Lp.<a class="code" href="class_lora_wan_object.html#a3432781cfedda764c71fa2839c54a9bd">GetNbOfReset</a>(); <span class="comment">// in this example adding number of reset inside the applicatif payload</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"></span>        Lp.<a class="code" href="class_lora_wan_object.html#abcb65e077d41cd395030e7679d8c4e3c">SetDataRateStrategy</a>( AppDataRate );</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">if</span> ( Lp.<a class="code" href="class_lora_wan_object.html#a0dc910d02d115bea5900567001fd2b77">IsJoined</a> ( ) == <a class="code" href="_define_8h.html#abe3daafdb4fec314926c12003b3ad390a13c93a198d97e6601b511be02492a86b">NOT_JOINED</a> ) {            </div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            LpState = Lp.<a class="code" href="class_lora_wan_object.html#a4585cc16886b0dc622ce768184d2d5e0">Join</a>( );</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            LpState = Lp.<a class="code" href="class_lora_wan_object.html#af5ed07270b8db6c03b6afeb9265fd2c1">SendPayload</a>( UserFport, UserPayload, UserPayloadSize, MsgType );</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <a class="code" href="_define_8h.html#af1206b4d3bda8c4c8c9257f369a9e9e1">DEBUG_MSG</a>(<span class="stringliteral">&quot;\n\n&quot;</span>);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keywordflow">while</span> ( LpState != <a class="code" href="_define_8h.html#a9aa4864b327c9be843762dbedf6419e4a8bd48a2deed5279c6bf53c9448af5ef0">LWPSTATE_IDLE</a> ){</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            LpState = Lp.<a class="code" href="class_lora_wan_object.html#aa833aaa609033491d4b8566bc93851cf">LoraWanProcess</a>( &amp;AvailableRxPacket );</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            <a class="code" href="main_8cpp.html#a3e7125d0f4c5b5efc1236698c02752ef">mcu</a>.GotoSleepMSecond ( 300 );</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            <a class="code" href="main_8cpp.html#a3e7125d0f4c5b5efc1236698c02752ef">mcu</a>.WatchDogRelease ( );</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        }</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordflow">if</span> ( LpState == <a class="code" href="_define_8h.html#a9aa4864b327c9be843762dbedf6419e4ab9aa8615258fbb9c33ade69e303c4d9d">LWPSTATE_ERROR</a> ) {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="comment">// user application have to save all the need</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            NVIC_SystemReset();</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">if</span> ( AvailableRxPacket == <a class="code" href="_define_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da7419d99f2624be41983cbb3062b4aa09">LORA_RX_PACKET_AVAILABLE</a> ) { </div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            Lp.<a class="code" href="class_lora_wan_object.html#ad78f345b6a38581433b4193df9c7d5f7">ReceivePayload</a>( &amp;UserRxFport, UserRxPayload, &amp;UserRxPayloadSize );</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <a class="code" href="_define_8h.html#a0be11ce2e33906806ac4e521781809c0">DEBUG_PRINTF</a>(<span class="stringliteral">&quot;Receive on port %d  an Applicative Downlink \n DATA[%d] = [ &quot;</span>,UserRxFport,UserRxPayloadSize);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            <span class="keywordflow">for</span> ( i = 0 ; i &lt; UserRxPayloadSize ; i++){</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                <a class="code" href="_define_8h.html#a0be11ce2e33906806ac4e521781809c0">DEBUG_PRINTF</a>( <span class="stringliteral">&quot;0x%.2x &quot;</span>,UserRxPayload[i]);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            }</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            <a class="code" href="_define_8h.html#af1206b4d3bda8c4c8c9257f369a9e9e1">DEBUG_MSG</a>(<span class="stringliteral">&quot;]\n\n\n&quot;</span>);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <span class="comment">// call the application layer to manage the application downlink</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        } </div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">if</span> ( Lp.<a class="code" href="class_lora_wan_object.html#a0dc910d02d115bea5900567001fd2b77">IsJoined</a> ( ) == <a class="code" href="_define_8h.html#abe3daafdb4fec314926c12003b3ad390a13c93a198d97e6601b511be02492a86b">NOT_JOINED</a> ) {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <a class="code" href="main_8cpp.html#a3e7125d0f4c5b5efc1236698c02752ef">mcu</a>.GotoSleepSecond(5);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <a class="code" href="main_8cpp.html#a3e7125d0f4c5b5efc1236698c02752ef">mcu</a>.GotoSleepSecond ( AppTimeSleeping );</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        </div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;}</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="ttc" id="main_8cpp_html_aa622c47d7e66633f4b919c1e7668f0f7"><div class="ttname"><a href="main_8cpp.html#aa622c47d7e66633f4b919c1e7668f0f7">LoRaMacAppSKeyInit</a></div><div class="ttdeci">uint8_t LoRaMacAppSKeyInit[]</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00047">main.cpp:47</a></div></div>
<div class="ttc" id="structs_lo_ra_wan_keys_html"><div class="ttname"><a href="structs_lo_ra_wan_keys.html">sLoRaWanKeys</a></div><div class="ttdef"><b>Definition:</b> <a href="_define_8h_source.html#l00266">Define.h:266</a></div></div>
<div class="ttc" id="_define_8h_html_a1287040ce87452e6c780ec0917441aeaa91850405983bdf8c8f74f6aada3dd398"><div class="ttname"><a href="_define_8h.html#a1287040ce87452e6c780ec0917441aeaa91850405983bdf8c8f74f6aada3dd398">STATIC_ADR_MODE</a></div><div class="ttdef"><b>Definition:</b> <a href="_define_8h_source.html#l00204">Define.h:204</a></div></div>
<div class="ttc" id="_user_define_8h_html_a34f60e4069b1e8a10b1e4e73a446f952"><div class="ttname"><a href="_user_define_8h.html#a34f60e4069b1e8a10b1e4e73a446f952">LORA_RESET</a></div><div class="ttdeci">#define LORA_RESET</div><div class="ttdef"><b>Definition:</b> <a href="_user_define_8h_source.html#l00053">UserDefine.h:53</a></div></div>
<div class="ttc" id="_define_8h_html_af1206b4d3bda8c4c8c9257f369a9e9e1"><div class="ttname"><a href="_define_8h.html#af1206b4d3bda8c4c8c9257f369a9e9e1">DEBUG_MSG</a></div><div class="ttdeci">#define DEBUG_MSG(str)</div><div class="ttdef"><b>Definition:</b> <a href="_define_8h_source.html#l00043">Define.h:43</a></div></div>
<div class="ttc" id="_define_8h_html_acabcd539e4bcc6575c90bd7d857b21f4"><div class="ttname"><a href="_define_8h.html#acabcd539e4bcc6575c90bd7d857b21f4">eLoraWan_Process_States</a></div><div class="ttdeci">enum LoraWan_Process_States eLoraWan_Process_States</div></div>
<div class="ttc" id="utilities_8h_html"><div class="ttname"><a href="utilities_8h.html">utilities.h</a></div></div>
<div class="ttc" id="_user_define_8h_html_a7d5bea89ac1696411e1f40209e7ebaa7"><div class="ttname"><a href="_user_define_8h.html#a7d5bea89ac1696411e1f40209e7ebaa7">LORA_SPI_SCLK</a></div><div class="ttdeci">#define LORA_SPI_SCLK</div><div class="ttdef"><b>Definition:</b> <a href="_user_define_8h_source.html#l00051">UserDefine.h:51</a></div></div>
<div class="ttc" id="class_s_x1276_html"><div class="ttname"><a href="class_s_x1276.html">SX1276</a></div><div class="ttdef"><b>Definition:</b> <a href="sx1276_8h_source.html#l00043">sx1276.h:43</a></div></div>
<div class="ttc" id="_define_8h_html_a1e0a07faefc3dd68bbdd06f7c856cc74ae38e7cd490c6c7efecee77617004e358"><div class="ttname"><a href="_define_8h.html#a1e0a07faefc3dd68bbdd06f7c856cc74ae38e7cd490c6c7efecee77617004e358">OTA_DEVICE</a></div><div class="ttdef"><b>Definition:</b> <a href="_define_8h_source.html#l00105">Define.h:105</a></div></div>
<div class="ttc" id="_api_mcu_8h_html"><div class="ttname"><a href="_api_mcu_8h.html">ApiMcu.h</a></div></div>
<div class="ttc" id="class_lora_wan_object_html_af5ed07270b8db6c03b6afeb9265fd2c1"><div class="ttname"><a href="class_lora_wan_object.html#af5ed07270b8db6c03b6afeb9265fd2c1">LoraWanObject::SendPayload</a></div><div class="ttdeci">eLoraWan_Process_States SendPayload(uint8_t fPort, const uint8_t *dataIn, const uint8_t sizeIn, uint8_t PacketType)</div><div class="ttdoc">Sends an uplink. </div><div class="ttdef"><b>Definition:</b> <a href="_lora_wan_process_8cpp_source.html#l00252">LoraWanProcess.cpp:252</a></div></div>
<div class="ttc" id="class_mcu_x_x_html"><div class="ttname"><a href="class_mcu_x_x.html">McuXX</a></div><div class="ttdef"><b>Definition:</b> <a href="_api_mcu_8h_source.html#l00030">ApiMcu.h:30</a></div></div>
<div class="ttc" id="structs_back_up_flash_html"><div class="ttname"><a href="structs_back_up_flash.html">sBackUpFlash</a></div><div class="ttdef"><b>Definition:</b> <a href="_lora_mac_data_store_in_flash_8h_source.html#l00026">LoraMacDataStoreInFlash.h:26</a></div></div>
<div class="ttc" id="_define_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2da97bb67b41ce2bd4f20bd3318c4c4739a"><div class="ttname"><a href="_define_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da97bb67b41ce2bd4f20bd3318c4c4739a">NO_LORA_RXPACKET_AVAILABLE</a></div><div class="ttdef"><b>Definition:</b> <a href="_define_8h_source.html#l00235">Define.h:235</a></div></div>
<div class="ttc" id="class_lora_wan_object_html_a29662757556ca754ab1b314efd350a6c"><div class="ttname"><a href="class_lora_wan_object.html#a29662757556ca754ab1b314efd350a6c">LoraWanObject::RestoreContext</a></div><div class="ttdeci">void RestoreContext(void)</div><div class="ttdoc">Reload the LoraWAN context saved in the flash. </div><div class="ttdef"><b>Definition:</b> <a href="_lora_wan_process_8cpp_source.html#l00339">LoraWanProcess.cpp:339</a></div></div>
<div class="ttc" id="_define_8h_html_a1287040ce87452e6c780ec0917441aea"><div class="ttname"><a href="_define_8h.html#a1287040ce87452e6c780ec0917441aea">eDataRateStrategy</a></div><div class="ttdeci">eDataRateStrategy</div><div class="ttdef"><b>Definition:</b> <a href="_define_8h_source.html#l00203">Define.h:203</a></div></div>
<div class="ttc" id="_define_8h_html_a0411cd49bb5b71852cecd93bcbf0ca2da7419d99f2624be41983cbb3062b4aa09"><div class="ttname"><a href="_define_8h.html#a0411cd49bb5b71852cecd93bcbf0ca2da7419d99f2624be41983cbb3062b4aa09">LORA_RX_PACKET_AVAILABLE</a></div><div class="ttdef"><b>Definition:</b> <a href="_define_8h_source.html#l00236">Define.h:236</a></div></div>
<div class="ttc" id="_lora_wan_process_8h_html"><div class="ttname"><a href="_lora_wan_process_8h.html">LoraWanProcess.h</a></div><div class="ttdoc">Minimalistic LoRaWAN stack implementation. </div></div>
<div class="ttc" id="main_8cpp_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00053">main.cpp:53</a></div></div>
<div class="ttc" id="_class_s_t_m32_l0_8h_html_aed07b4957134494f3545189abece0f04"><div class="ttname"><a href="_class_s_t_m32_l0_8h.html#aed07b4957134494f3545189abece0f04">TX_RX_IT</a></div><div class="ttdeci">#define TX_RX_IT</div><div class="ttdef"><b>Definition:</b> <a href="_class_s_t_m32_l0_8h_source.html#l00031">ClassSTM32L0.h:31</a></div></div>
<div class="ttc" id="_define_8h_html_a0be11ce2e33906806ac4e521781809c0"><div class="ttname"><a href="_define_8h.html#a0be11ce2e33906806ac4e521781809c0">DEBUG_PRINTF</a></div><div class="ttdeci">#define DEBUG_PRINTF(fmt, args...)</div><div class="ttdef"><b>Definition:</b> <a href="_define_8h_source.html#l00044">Define.h:44</a></div></div>
<div class="ttc" id="_define_8h_html"><div class="ttname"><a href="_define_8h.html">Define.h</a></div><div class="ttdoc">LoRaWan Mac parameters. </div></div>
<div class="ttc" id="appli_8h_html"><div class="ttname"><a href="appli_8h.html">appli.h</a></div></div>
<div class="ttc" id="_user_define_8h_html_a3f5699acd29748e068ddd6d6c28b8fab"><div class="ttname"><a href="_user_define_8h.html#a3f5699acd29748e068ddd6d6c28b8fab">LORA_SPI_MOSI</a></div><div class="ttdeci">#define LORA_SPI_MOSI</div><div class="ttdef"><b>Definition:</b> <a href="_user_define_8h_source.html#l00049">UserDefine.h:49</a></div></div>
<div class="ttc" id="_define_8h_html_a9aa4864b327c9be843762dbedf6419e4ab9aa8615258fbb9c33ade69e303c4d9d"><div class="ttname"><a href="_define_8h.html#a9aa4864b327c9be843762dbedf6419e4ab9aa8615258fbb9c33ade69e303c4d9d">LWPSTATE_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="_define_8h_source.html#l00062">Define.h:62</a></div></div>
<div class="ttc" id="class_lora_wan_object_html_a4585cc16886b0dc622ce768184d2d5e0"><div class="ttname"><a href="class_lora_wan_object.html#a4585cc16886b0dc622ce768184d2d5e0">LoraWanObject::Join</a></div><div class="ttdeci">eLoraWan_Process_States Join(void)</div><div class="ttdoc">to Send a Join request </div><div class="ttdef"><b>Definition:</b> <a href="_lora_wan_process_8cpp_source.html#l00209">LoraWanProcess.cpp:209</a></div></div>
<div class="ttc" id="class_lora_wan_object_html_a3432781cfedda764c71fa2839c54a9bd"><div class="ttname"><a href="class_lora_wan_object.html#a3432781cfedda764c71fa2839c54a9bd">LoraWanObject::GetNbOfReset</a></div><div class="ttdeci">uint8_t GetNbOfReset(void)</div><div class="ttdef"><b>Definition:</b> <a href="_lora_wan_process_8cpp_source.html#l00405">LoraWanProcess.cpp:405</a></div></div>
<div class="ttc" id="appli_8cpp_html_a717519fd04fb87ffa62bb98e5306b83b"><div class="ttname"><a href="appli_8cpp.html#a717519fd04fb87ffa62bb98e5306b83b">PrepareFrame</a></div><div class="ttdeci">void PrepareFrame(uint8_t *Buffer)</div><div class="ttdef"><b>Definition:</b> <a href="appli_8cpp_source.html#l00050">appli.cpp:50</a></div></div>
<div class="ttc" id="class_lora_wan_object_html_abcb65e077d41cd395030e7679d8c4e3c"><div class="ttname"><a href="class_lora_wan_object.html#abcb65e077d41cd395030e7679d8c4e3c">LoraWanObject::SetDataRateStrategy</a></div><div class="ttdeci">void SetDataRateStrategy(eDataRateStrategy adrModeSelect)</div><div class="ttdoc">SetDataRateStrategy of the devices. </div><div class="ttdef"><b>Definition:</b> <a href="_lora_wan_process_8cpp_source.html#l00305">LoraWanProcess.cpp:305</a></div></div>
<div class="ttc" id="_define_8h_html_a9aa4864b327c9be843762dbedf6419e4a8bd48a2deed5279c6bf53c9448af5ef0"><div class="ttname"><a href="_define_8h.html#a9aa4864b327c9be843762dbedf6419e4a8bd48a2deed5279c6bf53c9448af5ef0">LWPSTATE_IDLE</a></div><div class="ttdef"><b>Definition:</b> <a href="_define_8h_source.html#l00055">Define.h:55</a></div></div>
<div class="ttc" id="_define_8h_html_abe3daafdb4fec314926c12003b3ad390a13c93a198d97e6601b511be02492a86b"><div class="ttname"><a href="_define_8h.html#abe3daafdb4fec314926c12003b3ad390a13c93a198d97e6601b511be02492a86b">NOT_JOINED</a></div><div class="ttdef"><b>Definition:</b> <a href="_define_8h_source.html#l00240">Define.h:240</a></div></div>
<div class="ttc" id="main_8cpp_html_a2ed723ad16bfc8c263d17e23dde91bed"><div class="ttname"><a href="main_8cpp.html#a2ed723ad16bfc8c263d17e23dde91bed">AppEuiInit</a></div><div class="ttdeci">uint8_t AppEuiInit[]</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00049">main.cpp:49</a></div></div>
<div class="ttc" id="main_8cpp_html_a3e7125d0f4c5b5efc1236698c02752ef"><div class="ttname"><a href="main_8cpp.html#a3e7125d0f4c5b5efc1236698c02752ef">mcu</a></div><div class="ttdeci">McuXX&lt; McuSTM32L4 &gt; mcu(LORA_SPI_MOSI, LORA_SPI_MISO, LORA_SPI_SCLK)</div><div class="ttdoc">Radio Interrupt Pin declarations. </div></div>
<div class="ttc" id="_user_define_8h_html_a1cccfa48213935b19a2a848cc25cddf3"><div class="ttname"><a href="_user_define_8h.html#a1cccfa48213935b19a2a848cc25cddf3">LORA_CS</a></div><div class="ttdeci">#define LORA_CS</div><div class="ttdef"><b>Definition:</b> <a href="_user_define_8h_source.html#l00052">UserDefine.h:52</a></div></div>
<div class="ttc" id="_define_8h_html_a99fb83031ce9923c84392b4e92f956b5a6b0e555756b3d5210f52cc4f1c7b7f6a"><div class="ttname"><a href="_define_8h.html#a99fb83031ce9923c84392b4e92f956b5a6b0e555756b3d5210f52cc4f1c7b7f6a">UNCONF_DATA_UP</a></div><div class="ttdef"><b>Definition:</b> <a href="_define_8h_source.html#l00091">Define.h:91</a></div></div>
<div class="ttc" id="main_8cpp_html_a6103d2355d60728852bb0828c4bad37e"><div class="ttname"><a href="main_8cpp.html#a6103d2355d60728852bb0828c4bad37e">LoRaDevAddrInit</a></div><div class="ttdeci">uint32_t LoRaDevAddrInit</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00051">main.cpp:51</a></div></div>
<div class="ttc" id="_user_define_8h_html_af8db8e4d626d327ad8a7b2bf4455209c"><div class="ttname"><a href="_user_define_8h.html#af8db8e4d626d327ad8a7b2bf4455209c">LORA_SPI_MISO</a></div><div class="ttdeci">#define LORA_SPI_MISO</div><div class="ttdef"><b>Definition:</b> <a href="_user_define_8h_source.html#l00050">UserDefine.h:50</a></div></div>
<div class="ttc" id="main_8cpp_html_a095120399a6edc8ae3886936fc33eb20"><div class="ttname"><a href="main_8cpp.html#a095120399a6edc8ae3886936fc33eb20">LoRaMacNwkSKeyInit</a></div><div class="ttdeci">uint8_t LoRaMacNwkSKeyInit[]</div><div class="ttdoc">Parameters of the LoraWanKeys structure. </div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00046">main.cpp:46</a></div></div>
<div class="ttc" id="_lora_mac_data_store_in_flash_8h_html"><div class="ttname"><a href="_lora_mac_data_store_in_flash_8h.html">LoraMacDataStoreInFlash.h</a></div><div class="ttdoc">LoRaWan Context stored in flash. </div></div>
<div class="ttc" id="class_lora_wan_object_html"><div class="ttname"><a href="class_lora_wan_object.html">LoraWanObject</a></div><div class="ttdoc">An absolutely minimalistic LoRaWAN Class A stack implementation . </div><div class="ttdef"><b>Definition:</b> <a href="_lora_wan_process_8h_source.html#l00038">LoraWanProcess.h:38</a></div></div>
<div class="ttc" id="_user_define_8h_html_ac4f86f88b3a4d50662612b4e40c63c83"><div class="ttname"><a href="_user_define_8h.html#ac4f86f88b3a4d50662612b4e40c63c83">USERFLASHADRESS</a></div><div class="ttdeci">#define USERFLASHADRESS</div><div class="ttdef"><b>Definition:</b> <a href="_user_define_8h_source.html#l00061">UserDefine.h:61</a></div></div>
<div class="ttc" id="main_8cpp_html_a41858b10db6a7676108c1193fd9efaba"><div class="ttname"><a href="main_8cpp.html#a41858b10db6a7676108c1193fd9efaba">DevEuiInit</a></div><div class="ttdeci">uint8_t DevEuiInit[]</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00050">main.cpp:50</a></div></div>
<div class="ttc" id="_class_s_t_m32_l0_8h_html_a106bb2c77f5f8bbd6ec084f37e9c6506"><div class="ttname"><a href="_class_s_t_m32_l0_8h.html#a106bb2c77f5f8bbd6ec084f37e9c6506">RX_TIMEOUT_IT</a></div><div class="ttdeci">#define RX_TIMEOUT_IT</div><div class="ttdef"><b>Definition:</b> <a href="_class_s_t_m32_l0_8h_source.html#l00032">ClassSTM32L0.h:32</a></div></div>
<div class="ttc" id="_user_define_8h_html"><div class="ttname"><a href="_user_define_8h.html">UserDefine.h</a></div></div>
<div class="ttc" id="main_8cpp_html_aaec460fc9ebcf36ea2ecd5ad4826ec36"><div class="ttname"><a href="main_8cpp.html#aaec460fc9ebcf36ea2ecd5ad4826ec36">LoRaMacAppKeyInit</a></div><div class="ttdeci">uint8_t LoRaMacAppKeyInit[]</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00048">main.cpp:48</a></div></div>
<div class="ttc" id="main_8cpp_html_af39987ed395cff959b6956b3452952be"><div class="ttname"><a href="main_8cpp.html#af39987ed395cff959b6956b3452952be">BackUpFlash</a></div><div class="ttdeci">struct sBackUpFlash BackUpFlash</div><div class="ttdoc">BackUpFlash The LoraWan structure parameters save into the flash memory for failsafe restauration...</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00033">main.cpp:33</a></div></div>
<div class="ttc" id="class_lora_wan_object_html_ad78f345b6a38581433b4193df9c7d5f7"><div class="ttname"><a href="class_lora_wan_object.html#ad78f345b6a38581433b4193df9c7d5f7">LoraWanObject::ReceivePayload</a></div><div class="ttdeci">eStatusLoRaWan ReceivePayload(uint8_t *UserRxFport, uint8_t *UserRxPayload, uint8_t *UserRxPayloadSize)</div><div class="ttdoc">Receive Applicative Downlink. </div><div class="ttdef"><b>Definition:</b> <a href="_lora_wan_process_8cpp_source.html#l00288">LoraWanProcess.cpp:288</a></div></div>
<div class="ttc" id="class_lora_wan_object_html_a0dc910d02d115bea5900567001fd2b77"><div class="ttname"><a href="class_lora_wan_object.html#a0dc910d02d115bea5900567001fd2b77">LoraWanObject::IsJoined</a></div><div class="ttdeci">eJoinStatus IsJoined(void)</div><div class="ttdoc">Returns the join state. </div><div class="ttdef"><b>Definition:</b> <a href="_lora_wan_process_8cpp_source.html#l00235">LoraWanProcess.cpp:235</a></div></div>
<div class="ttc" id="class_lora_wan_object_html_aa833aaa609033491d4b8566bc93851cf"><div class="ttname"><a href="class_lora_wan_object.html#aa833aaa609033491d4b8566bc93851cf">LoraWanObject::LoraWanProcess</a></div><div class="ttdeci">eLoraWan_Process_States LoraWanProcess(uint8_t *AvailableRxPacket)</div><div class="ttdoc">Runs the MAC layer state machine. Must be called periodically by the application. Not timing critical...</div><div class="ttdef"><b>Definition:</b> <a href="_lora_wan_process_8cpp_source.html#l00048">LoraWanProcess.cpp:48</a></div></div>
<div class="ttc" id="_s_x126x_8h_html"><div class="ttname"><a href="_s_x126x_8h.html">SX126x.h</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
